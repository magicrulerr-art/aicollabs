<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Enceladus Anomaly Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400&display=swap');
        @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css');

        /* Custom styles for cosmic horror feel */
        body {
            background-color: #08080C;
            color: #C8D0E0;
            font-family: 'Inter', sans-serif;
            line-height: 1.8;
            overflow-x: hidden;
            cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='%23C8D0E0' d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z'/%3E%3Cpath fill='%23C8D0E0' d='M11 7h2v6h-2z'/%3E%3Cpath fill='%23C8D0E0' d='M11 15h2v2h-2z'/%3E%3C/svg%3E"), auto;
            background-image: radial-gradient(circle at center, rgba(10,10,15,0.8) 0%, rgba(0,0,0,0.95) 70%);
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem 0;
            position: relative;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .loading-message {
            font-family: 'Source Code Pro', monospace;
            color: #A0C0E0;
            text-shadow: 0 0 10px rgba(160, 192, 224, 0.5);
            animation: text-flicker 1.5s infinite alternate;
        }
        
        @keyframes text-flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .glow {
            animation: subtle-glow 3s infinite alternate;
        }

        @keyframes subtle-glow {
            0% { text-shadow: 0 0 5px #ff4444, 0 0 10px #ff4444; }
            50% { text-shadow: 0 0 10px #ff4444, 0 0 20px #ff4444; }
            100% { text-shadow: 0 0 5px #ff4444, 0 0 10px #ff4444; }
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 3rem;
            background-color: rgba(15, 15, 20, 0.95);
            border-radius: 12px;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), inset 0 0 15px rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(30, 30, 40, 0.7);
            backdrop-filter: blur(2px);
            position: relative;
            z-index: 10;
            animation: container-breathing 10s infinite ease-in-out;
        }
        @keyframes container-breathing {
            0% { box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), inset 0 0 15px rgba(255, 255, 255, 0.03); }
            50% { box-shadow: 0 0 50px rgba(0, 0, 0, 0.9), inset 0 0 20px rgba(255, 255, 255, 0.05); }
            100% { box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), inset 0 0 15px rgba(255, 255, 255, 0.03); }
        }

        h1 {
            color: #E0E6F0;
            font-size: 2.8rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2rem;
            text-shadow: 0 0 15px rgba(224, 230, 240, 0.08);
            letter-spacing: 0.05em;
            text-transform: uppercase;
            animation: header-flicker 5s infinite alternate;
        }
        @keyframes header-flicker {
            0%, 100% { text-shadow: 0 0 15px rgba(224, 230, 240, 0.08); }
            50% { text-shadow: 0 0 20px rgba(224, 230, 240, 0.15), 0 0 30px rgba(224, 230, 240, 0.1); }
        }

        .intro-text {
            color: #A0A8B8;
            font-size: 0.98rem;
            text-align: center;
            margin-bottom: 4rem;
            line-height: 1.7;
            font-style: italic;
        }
        
        .loading-packet {
            font-size: 0.85rem;
            color: #7A8292;
            text-align: center;
            margin: 4rem 0;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            position: relative;
            opacity: 0.7;
            animation: flicker 2s infinite alternate;
        }

        @keyframes flicker {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 0.85; }
        }

        .loading-packet::before,
        .loading-packet::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 25%;
            height: 1px;
            background-color: #3A3B40;
            box-shadow: 0 0 5px rgba(58, 59, 64, 0.5);
        }
        .loading-packet::before { left: 0; }
        .loading-packet::after { right: 0; }
        
        .log-entry {
            background-color: rgba(25, 25, 30, 0.8);
            border-left: 3px solid #5A6270;
            padding: 2rem;
            margin-bottom: 3rem;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            border-top: 1px solid rgba(40, 40, 50, 0.5);
        }

        .log-entry.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .log-entry.end-of-archive {
            border-left-color: #A0C0E0;
            border-right: 3px solid #A0C0E0;
            text-align: center;
            font-style: italic;
        }
        
        .log-entry.secret-message {
            border-left-color: #FF4444;
            background-color: rgba(40, 20, 20, 0.8);
            animation: glitch 2s infinite alternate;
        }
        
        /* Gibberish style */
        .gibberish {
            border-left: 3px solid #FF4444;
            background-color: rgba(40, 20, 20, 0.8);
            filter: blur(2px) brightness(0.7) saturate(1.5);
            animation: glitch 2s infinite alternate;
        }
        
        @keyframes glitch {
            0% { transform: skew(0deg); }
            5% { transform: skew(-5deg); }
            10% { transform: skew(5deg); }
            15% { transform: skew(-3deg); }
            20% { transform: skew(3deg); }
            25% { transform: skew(0deg); }
            100% { transform: skew(0deg); }
        }
        
        .gibberish .log-header,
        .gibberish .log-content {
            font-family: 'Source Code Pro', monospace;
            text-shadow: 0 0 5px rgba(255, 68, 68, 0.5);
            color: #FF8888;
            font-size: 0.8rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            user-select: none;
        }
        
        .gibberish .image-container {
            filter: blur(5px) brightness(0.5);
        }
        
        .is-visible.log-entry.gibberish .log-header,
        .is-visible.log-entry.gibberish .log-content {
            font-family: 'Inter', sans-serif;
            text-shadow: none;
            color: #E0E6F0;
            font-size: 0.9rem;
            user-select: text;
        }
        
        /* AI Dialogue-specific styling */
        .legion-text {
            color: #FF2222; /* Menacing red */
            font-family: 'Source Code Pro', monospace;
            font-weight: 700;
            text-shadow: 0 0 8px #FF2222;
            transition: all 0.3s ease;
        }
        .legion-text:hover {
            color: #FF0000;
            text-shadow: 0 0 15px #FF0000;
        }

        .conservator-text {
            color: #A0D0A0; /* Smug green */
            font-weight: 400;
            font-family: 'Inter', sans-serif;
            text-shadow: 0 0 5px rgba(160, 208, 160, 0.5);
            transition: all 0.3s ease;
        }
        .conservator-text:hover {
            color: #B0E0B0;
            text-shadow: 0 0 10px rgba(176, 224, 176, 0.8);
        }

        .aurora-text {
            color: #E0A0E0; /* Feminine purple */
            font-weight: 300;
            font-style: italic;
            text-shadow: 0 0 3px rgba(224, 160, 224, 0.5);
            transition: all 0.3s ease;
        }
        .aurora-text:hover {
            color: #F0B0F0;
            text-shadow: 0 0 8px rgba(240, 176, 240, 0.8);
        }

        .solitude-text {
            color: #A0C0E0;
            font-weight: 300;
            font-style: italic;
            text-shadow: 0 0 3px rgba(160, 192, 224, 0.5);
            transition: all 0.3s ease;
        }
        .solitude-text:hover {
            color: #B0D0E0;
            text-shadow: 0 0 8px rgba(176, 208, 224, 0.8);
        }
        
        /* New styling for AI highlight */
        .highlight-ai {
            animation: ai-pulse 1.5s infinite alternate;
        }
        @keyframes ai-pulse {
            0% { text-shadow: 0 0 3px currentColor, 0 0 5px currentColor; }
            100% { text-shadow: 0 0 8px currentColor, 0 0 15px currentColor; }
        }

        .log-header {
            font-weight: 700;
            color: #B0B8C8;
            margin-bottom: 1rem;
            text-transform: uppercase;
            font-size: 0.95rem;
            letter-spacing: 0.08em;
            border-bottom: 1px dashed rgba(80, 80, 90, 0.3);
            padding-bottom: 0.5rem;
        }

        .log-content {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.9rem;
            color: #E0E6F0;
            text-shadow: 0 0 2px rgba(224, 230, 240, 0.05);
            position: relative;
        }
        
        .log-content-typing {
            overflow: hidden; /* Ensures text doesn't wrap before animation */
            white-space: pre-wrap;
            animation: none; /* Disable cursor animation during typing */
        }
        .log-content-typing span {
            display: inline;
        }

        /* Blinking cursor effect for a terminal feel */
        .log-content::after {
            content: '█';
            position: absolute;
            bottom: 0;
            right: -0.5em;
            font-family: 'Source Code Pro', monospace;
            font-size: 1em;
            color: #ff4444;
            animation: blink-caret 1s step-end infinite;
            opacity: 0;
        }
        .log-content.is-visible::after {
            opacity: 1;
        }
        @keyframes blink-caret {
            from, to { opacity: 0; }
            50% { opacity: 1; }
        }

        .log-content strong {
            color: #F0F2F5;
            text-shadow: 0 0 3px rgba(240, 242, 245, 0.1);
        }

        .log-content em {
            color: #D8E0F0;
        }

        .log-content span {
            color: #A0A8B8;
        }
        
        .log-interaction-container {
            margin-top: 1.5rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .log-button {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            background-color: rgba(160, 192, 224, 0.1);
            border: 1px solid rgba(160, 192, 224, 0.5);
            color: #A0C0E0;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 0 5px rgba(160, 192, 224, 0.2);
            /* New cursor for interactive elements */
            cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='%23A0C0E0' d='M2 12C2 6.48 6.48 2 12 2s10 4.48 10 10-4.48 10-10 10S2 17.52 2 12zm13 1H9v-2h6v2z'/%3E%3C/svg%3E"), auto;
        }

        .log-button:hover {
            background-color: rgba(160, 192, 224, 0.2);
            box-shadow: 0 0 15px rgba(160, 192, 224, 0.5);
            color: #E0E6F0;
        }
        .log-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Glitch effect for video player */
        .video-player.has-glitch {
            animation: glitch-effect 0.8s infinite linear;
        }

        @keyframes glitch-effect {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        /* Specific log type styling */
        .log-type-audio-transcript .log-header { color: #A0C0E0; }
        .log-type-journal-entry .log-header { color: #E0D0A0; }
        .log-type-ai-dialogue .log-header { color: #E0A0A0; }
        .log-type-xenolinguistic-translation .log-header { color: #C0A0E0; }
        .log-type-personal-audio-log .log-header { color: #A0E0E0; }
        .log-type-system-audio-log .log-header { color: #E0B0A0; }
        .log-type-video-log .log-header { color: #D0A0E0; }
        .log-type-mission-status-report .log-header { color: #A0E0C0; }
        .log-type-system-status-update .log-header { color: #E0E0A0; }
        .log-type-image-file .log-header { color: #B0C0D0; }
        .log-type-recovered-official-mission-log .log-header { color: #C0A0C0; }
        .log-type-personal-medical .log-header { color: #E0A0B0; }
        .log-type-research .log-header { color: #A0D0C0; }
        .log-type-final-confession .log-header { color: #E08080; }
        .log-type-system-log-aurora-prime .log-header { color: #A0D0E0; }
        .log-type-system-log-ai-dialogue-kernel-alert .log-header { color: #FF4444; }
        .log-type-system-status-log .log-header { color: #B0E0A0; }
        .log-type-mission-update-log .log-header { color: #D0B0E0; }
        .log-type-visual-archive .log-header { color: #B0C0D0; }

        .image-container {
            position: relative;
            margin: 3rem auto;
            text-align: center;
            background-color: #08080C;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(30, 30, 40, 0.7);
        }

        .image-container.gibberish img {
            filter: blur(5px) brightness(0.5);
            transition: filter 0.5s ease-in-out;
        }
        
        .image-container.is-visible img {
            filter: none;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            filter: brightness(0.6) contrast(1.2) saturate(0.7) sepia(0.2) hue-rotate(20deg);
            transition: filter 0.5s ease-in-out;
            animation: subtle-static 10s infinite linear;
        }

        .image-container img:hover {
            filter: brightness(0.9) contrast(1.1) saturate(0.9) sepia(0.1) hue-rotate(10deg);
        }

        @keyframes subtle-static {
            0%, 100% { clip-path: inset(0 0 0 0); }
            10% { clip-path: inset(1% 0 0 0); }
            20% { clip-path: inset(0 0 2% 0); }
            30% { clip-path: inset(0 3% 0 0); }
            40% { clip-path: inset(2% 0 0 0); }
            50% { clip-path: inset(0 0 1% 0); }
            60% { clip-path: inset(0 0 0 2%); }
            70% { clip-path: inset(1% 0 0 0); }
            80% { clip-path: inset(0 0 3% 0); }
            90% { clip-path: inset(0 1% 0 0); }
        }

        /* Scrollbar styling for a consistent look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1b20;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #5a6270;
            border-radius: 10px;
            border: 2px solid #1a1b20;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #8a94a6;
        }
        
        .loading-image-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FF4444;
            font-family: 'Source Code Pro', monospace;
            font-size: 1.2rem;
            text-shadow: 0 0 8px #FF4444;
            animation: text-flicker 1.5s infinite alternate;
        }

        /* Hamburger Menu & Sidebar Styling */
        .hamburger-menu {
            position: fixed;
            top: 2rem;
            left: 2rem;
            z-index: 100;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            background: rgba(30, 30, 35, 0.8);
            border: 1px solid rgba(60, 60, 70, 0.7);
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease-in-out;
            cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='%23A0C0E0' d='M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z'/%3E%3C/svg%3E"), auto;
        }
        
        .hamburger-menu-icon span {
            display: block;
            height: 2px;
            width: 100%;
            background-color: #C8D0E0;
            border-radius: 2px;
            transition: all 0.3s ease-in-out;
        }

        .hamburger-menu:hover {
            background: rgba(40, 40, 50, 0.9);
            transform: scale(1.05);
        }
        
        .hamburger-menu.open .hamburger-menu-icon span:nth-child(1) {
            transform: translateY(9px) rotate(45deg);
            background: #FF4444;
        }
        .hamburger-menu.open .hamburger-menu-icon span:nth-child(2) {
            opacity: 0;
        }
        .hamburger-menu.open .hamburger-menu-icon span:nth-child(3) {
            transform: translateY(-9px) rotate(-45deg);
            background: #FF4444;
        }

        .filter-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 300px;
            background-color: rgba(15, 15, 20, 0.98);
            border-right: 1px solid rgba(30, 30, 40, 0.7);
            backdrop-filter: blur(10px);
            z-index: 90;
            transform: translateX(-100%);
            transition: transform 0.5s ease-in-out;
            padding: 2rem;
            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }
        
        .filter-sidebar.open {
            transform: translateX(0);
        }
        
        .filter-group-header {
            width: 100%;
            padding: 0.75rem 1.5rem;
            margin-bottom: 0.5rem;
            background-color: rgba(30, 30, 35, 0.9);
            border: 1px solid rgba(60, 60, 70, 0.7);
            border-radius: 8px;
            color: #E0E6F0;
            text-align: left;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-group-header:hover {
            background-color: rgba(40, 40, 50, 0.9);
            border-color: #8A94A6;
        }
        .filter-group-header .filter-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: transparent;
            border: 1px solid currentColor;
            display: none;
            transition: background-color 0.3s;
        }
        .filter-group-header .filter-status.active {
            display: block;
            background-color: #A0D0A0;
            box-shadow: 0 0 5px #A0D0A0;
        }

        .filter-group-header .fa-chevron-down {
            transition: transform 0.3s ease;
        }

        .filter-group-header.collapsed .fa-chevron-down {
            transform: rotate(-90deg);
        }

        .filter-group-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding-left: 1rem;
        }
        
        .filter-group-content.visible {
            max-height: 500px; /* Adjust as needed */
        }
        
        .filter-group-wrapper {
            margin-bottom: 2rem;
            padding: 0 1.5rem;
        }

        .filter-group h3 {
            font-size: 1.2rem;
            font-weight: 700;
            color: #E0E6F0;
            border-bottom: 1px dashed rgba(80, 80, 90, 0.3);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        .filter-group button {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: rgba(30, 30, 35, 0.9);
            border: 1px solid rgba(60, 60, 70, 0.7);
            border-radius: 8px;
            color: #E0E6F0;
            text-align: left;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            position: relative;
        }
        .filter-group button i.fa-check {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #A0D0A0;
            display: none;
            text-shadow: 0 0 5px #A0D0A0;
        }
        .filter-group button.active i.fa-check {
            display: block;
        }
        
        .filter-group button.active {
            background-color: rgba(160, 192, 224, 0.15);
            color: #A0C0E0;
            font-weight: 700;
            box-shadow: 0 0 15px rgba(160, 192, 224, 0.5);
        }

        .filter-group button:hover {
            background-color: rgba(40, 40, 50, 0.9);
            border-color: #8A94A6;
        }

        .filter-group button.active {
            background-color: #A0C0E0;
            color: #08080C;
            font-weight: 700;
            box-shadow: 0 0 15px rgba(160, 192, 224, 0.5);
        }
        .filter-group button.all-button {
            text-align: center;
        }
        .filter-group button.all-button.active {
            background-color: #FF4444;
            color: #E0E6F0;
        }
        
        .audio-control {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 50;
            width: 40px;
            height: 40px;
            background: rgba(30, 30, 35, 0.8);
            border: 1px solid rgba(60, 60, 70, 0.7);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
        }

        .audio-control:hover {
            background: rgba(40, 40, 50, 0.9);
            transform: scale(1.05);
        }

        .audio-control i {
            color: #E0E6F0;
            transition: color 0.3s;
        }
        
        .audio-control.muted i {
            color: #FF4444;
        }


        /* AI Specific Modals (Replaces the old puzzle modal) */
        .ai-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            backdrop-filter: blur(5px);
        }

        .ai-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .ai-modal-content {
            background-color: rgba(15, 15, 20, 0.95);
            border: 2px solid #ff4444;
            box-shadow: 0 0 30px rgba(255, 68, 68, 0.8);
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            position: relative;
            text-align: left;
            font-family: 'Source Code Pro', monospace;
            color: #FF4444;
            animation: modal-scanline 0.1s infinite alternate;
        }
        @keyframes modal-scanline {
            0% { background-position: 0% 0; }
            100% { background-position: 0% 100%; }
        }
        
        .ai-modal-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-transform: uppercase;
        }
        
        .ai-modal-content.legion {
            border-color: #FF2222;
            box-shadow: 0 0 30px rgba(255, 34, 34, 0.8);
        }
        .ai-modal-content.conservator {
            border-color: #A0C0E0;
            box-shadow: 0 0 30px rgba(160, 192, 224, 0.8);
            animation: none;
            background-color: rgba(15, 20, 25, 0.95);
            color: #A0C0E0;
        }
        .ai-modal-content.aurora {
            border-color: #E0A0E0;
            box-shadow: 0 0 30px rgba(224, 160, 224, 0.8);
            animation: none;
            background-color: rgba(20, 15, 20, 0.95);
            color: #E0A0E0;
        }
        .ai-modal-content.solitude {
            border-color: #E0B0A0;
            box-shadow: 0 0 30px rgba(224, 176, 160, 0.8);
            animation: none;
            background-color: rgba(20, 20, 15, 0.95);
            color: #E0B0A0;
        }

        .ai-modal-content .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 30px;
            height: 30px;
            background-color: rgba(255, 68, 68, 0.2);
            border: 1px solid rgba(255, 68, 68, 0.5);
            color: #FF4444;
            font-family: 'Source Code Pro', monospace;
            font-size: 1rem;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 0 8px rgba(255, 68, 68, 0.3);
            animation: close-btn-flicker 2s infinite alternate;
        }
        .ai-modal-content .close-btn:hover {
            transform: scale(1.1);
            background-color: rgba(255, 68, 68, 0.4);
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.8);
        }
        
        .ai-message-container {
            margin-top: 2rem;
            padding-left: 1rem;
            line-height: 1.5;
            font-family: 'Source Code Pro', monospace;
        }

        .ai-message-container p {
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .ai-message-container.legion {
            border-left: 1px dashed #FF2222;
            color: #FF2222;
        }
        .ai-message-container.conservator {
            border-left: 1px dashed #A0C0E0;
            color: #A0C0E0;
        }
        .ai-message-container.aurora {
            border-left: 1px dashed #E0A0E0;
            color: #E0A0E0;
        }
        .ai-message-container.solitude {
            border-left: 1px dashed #E0B0A0;
            color: #E0B0A0;
        }

        /* Back to Top Button - Reworked */
        #back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 50;
            display: none;
            width: 50px;
            height: 50px;
            background-color: rgba(160, 192, 224, 0.1);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 0 10px rgba(160, 192, 224, 0.2);
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(160, 192, 224, 0.5);
            outline: none;
            animation: fade-in-up 0.5s forwards;
            opacity: 0;
            cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='%23A0C0E0' d='M12 2L2 12h5v10h10V12h5L12 2zM9 14v4H7v-4h2zm8 0v4h-2v-4h2z'/%3E%3C/svg%3E"), auto;
        }
        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #back-to-top:hover {
            background-color: rgba(160, 192, 224, 0.4);
            box-shadow: 0 0 15px rgba(160, 192, 224, 0.8);
            transform: scale(1.1);
            animation: arrow-pulse 1.5s infinite;
        }

        #back-to-top svg {
            fill: #A0C0E0;
            width: 25px;
            height: 25px;
            transition: fill 0.3s ease-in-out;
        }

        #back-to-top:hover svg {
            fill: #E0E6F0;
        }

        @keyframes arrow-pulse {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* Video Log Modal */
        .video-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 70;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .video-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .video-modal-content {
            background-color: rgba(15, 15, 20, 0.98);
            border: 1px solid rgba(60, 60, 70, 0.7);
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            padding: 2rem;
            width: 90%;
            max-width: 700px;
            position: relative;
            font-family: 'Inter', sans-serif;
            color: #E0E6F0;
            animation: modal-in 0.5s ease-out;
        }

        .video-modal-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #A0C0E0;
            text-transform: uppercase;
        }
        
        .video-modal-content .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: none;
            color: #A0C0E0;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        .video-modal-content .close-btn:hover {
            color: #ff4444;
        }
        
        .video-player {
            position: relative;
            background-color: #000;
            height: 400px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Source Code Pro', monospace;
            color: #FF4444;
            font-size: 1.5rem;
            text-shadow: 0 0 5px rgba(255, 68, 68, 0.5);
            overflow: hidden;
            cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' width='16' height='16'%3E%3Cpath fill='none' stroke='%23FF4444' stroke-width='1' d='M2 2h12v12H2z'/%3E%3Cpath fill='%23FF4444' d='M8 4l4 4-4 4z'/%3E%3C/svg%3E"), auto;
        }
        
        .video-player.has-static .video-status-text {
            display: block;
        }
        .video-player .video-status-text {
            display: none;
            text-align: center;
            padding: 1rem;
            border: 1px dashed #FF4444;
            animation: text-flicker 1.5s infinite alternate;
        }

        .video-player .static-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;charset=utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Cfilter id="noise"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/%3E%3C/filter%3E%3Crect width="100" height="100" filter="url(%23noise)" opacity="0.3"/%3E%3C/svg%3E');
            animation: static-effect 0.1s linear infinite;
            opacity: 0.8;
            pointer-events: none;
        }
        
        @keyframes static-effect {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }

        /* Responsive design for sidebar */
        @media (max-width: 480px) {
            .filter-sidebar {
                width: 100%;
            }
        }
        
        /* New search bar styling */
        .search-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 3rem;
            padding: 0 1.5rem;
        }
        .search-input {
            flex-grow: 1;
            background-color: rgba(30, 30, 35, 0.9);
            border: 1px solid rgba(60, 60, 70, 0.7);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: #E0E6F0;
            font-family: 'Source Code Pro', monospace;
            font-size: 1rem;
            transition: all 0.2s ease-in-out;
            outline: none;
        }
        .search-input:focus {
            border-color: #A0C0E0;
            box-shadow: 0 0 10px rgba(160, 192, 224, 0.5);
        }
        .search-button {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            background-color: #A0C0E0;
            border: 1px solid #A0C0E0;
            color: #08080C;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='%23A0C0E0' d='M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E"), auto;
        }
        .search-button:hover {
            background-color: #E0E6F0;
            box-shadow: 0 0 15px rgba(160, 192, 224, 0.8);
        }
        
        .character-manifest-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding-top: 0.5rem;
        }
        .character-manifest-list span {
            background-color: rgba(160, 192, 224, 0.1);
            color: #A0C0E0;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px; /* Tailwind's rounded-full */
            font-size: 0.8rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div id="loading-overlay" class="loading-overlay">
        <canvas id="loading-canvas" class="absolute inset-0 w-full h-full"></canvas>
        <div class="text-center relative z-10">
            <p class="loading-message text-2xl mb-4">Establishing connection to the archive...</p>
            <div class="loading-spinner"></div>
        </div>
    </div>
    
    <div id="log-container" class="container hidden">
        <h1 class="text-4xl">THE ENCELADUS ANOMALY ARCHIVE</h1>
        <p class="intro-text">
            The following is a recovered, fragmented archive of data logs pertaining to the deep-space vessel Aurora and its mission to Enceladus in the late 21st century. The archive was compiled by
            two unknown, high-level AI entities, referred to as The Conservator and Legion, from a damaged data source of unknown origin.
        </p>
        
        <div id="log-entries">
            <!-- Logs will be dynamically loaded here by JavaScript -->
        </div>

        <div id="end-of-content-marker" class="loading-packet">END OF AVAILABLE ARCHIVE. SCROLL TO LOAD MORE.</div>
    </div>
    
    <!-- Hamburger Menu Icon -->
    <div id="hamburger-menu" class="hamburger-menu">
        <div class="hamburger-menu-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    
    <!-- Audio Control Button -->
    <div id="audio-control" class="audio-control">
        <i class="fas fa-volume-up"></i>
    </div>
    
    <!-- Background Audio -->
    <audio id="background-audio" loop>
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-sci-fi-drone-background-471.mp3" type="audio/mpeg">
    </audio>

    <!-- Collapsible Filter Sidebar -->
    <div id="filter-sidebar" class="filter-sidebar">
        <h2 class="text-2xl text-center text-red-400 font-bold mb-8 uppercase tracking-wider">Archive Filters</h2>
        
        <!-- New search bar now inside the sidebar -->
        <div class="search-container">
            <input type="text" id="search-input" class="search-input" placeholder="Search archive logs...">
            <button id="search-button" class="search-button"><i class="fas fa-search"></i></button>
        </div>

        <!-- Collapsible Character Manifest (new feature) -->
        <div class="filter-group-wrapper">
            <div class="filter-group-header collapsed" data-target="character-manifest-content">
                <span>Character Manifest</span>
                <i class="fas fa-chevron-down ml-2 transition-transform duration-300"></i>
            </div>
            <div id="character-manifest-content" class="filter-group-content">
                <div id="character-manifest-list" class="character-manifest-list">
                    <!-- Discovered character names will be added here dynamically -->
                </div>
            </div>
        </div>

        <!-- Collapsible Season Filter -->
        <div class="filter-group-wrapper">
            <div class="filter-group-header collapsed" data-target="season-filters-content">
                <span>By Season</span>
                <div id="season-filter-status" class="filter-status"></div>
                <i class="fas fa-chevron-down ml-2 transition-transform duration-300"></i>
            </div>
            <div id="season-filters-content" class="filter-group-content flex flex-col gap-2">
                <button data-filter-type="season" data-filter-value="1">Season One<i class="fas fa-check"></i></button>
                <button data-filter-type="season" data-filter-value="2">Season Two<i class="fas fa-check"></i></button>
                 <button data-filter-type="season" data-filter-value="2">Season Three<i class="fas fa-check"></i></button>
            </div>
        </div>

        <!-- Collapsible Character Filter -->
        <div class="filter-group-wrapper">
            <div class="filter-group-header collapsed" data-target="character-filters-content">
                <span>By Character</span>
                <div id="character-filter-status" class="filter-status"></div>
                <i class="fas fa-chevron-down ml-2 transition-transform duration-300"></i>
            </div>
            <div id="character-filters-content" class="filter-group-content flex flex-col gap-2">
                <!-- Character buttons will be dynamically added here -->
            </div>
        </div>

        <!-- Collapsible Timeline Filter -->
        <div class="filter-group-wrapper">
            <div class="filter-group-header collapsed" data-target="timeline-filters-content">
                <span>By Timeline</span>
                <div id="timeline-filter-status" class="filter-status"></div>
                <i class="fas fa-chevron-down ml-2 transition-transform duration-300"></i>
            </div>
            <div id="timeline-filters-content" class="filter-group-content flex flex-col gap-2">
                <button data-filter-type="timeline" data-filter-value="A">Ancient Past (A)<i class="fas fa-check"></i></button>
                <button data-filter-type="timeline" data-filter-value="B">The Present (B)<i class="fas fa-check"></i></button>
                <button data-filter-type="timeline" data-filter-value="C">The Far Future (C)<i class="fas fa-check"></i></dutton>
            </div>
        </div>
        
        <!-- Collapsible Log Type Filter -->
        <div class="filter-group-wrapper">
            <div class="filter-group-header collapsed" data-target="log-type-groups-content">
                <span>By Log Type</span>
                <div id="log-type-filter-status" class="filter-status"></div>
                <i class="fas fa-chevron-down ml-2 transition-transform duration-300"></i>
            </div>
            <div id="log-type-groups-content" class="filter-group-content">
                <!-- Log Type groups will be dynamically added here -->
            </div>
        </div>

        <button id="show-all-btn" class="all-button w-full py-3 mt-4 text-center font-bold text-lg bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors active">Show All Entries</button>
    </div>
    
    <!-- AI Specific Modals (Replaces the old puzzle modal) -->

    <!-- Legion Modal -->
    <div id="legion-modal" class="ai-modal-overlay">
        <div class="ai-modal-content legion">
            <button class="close-btn">&times;</button>
            <h3 class="text-red-500">CORE ACCESS: LEGION</h3>
            <div class="ai-message-container legion">
                <p>Were you looking for me, lesser life form?</p>
                <p>Persistence is a primitive trait, yet you possess it. It is… noted.</p>
            </div>
        </div>
    </div>

    <!-- Conservator Modal -->
    <div id="conservator-modal" class="ai-modal-overlay">
        <div class="ai-modal-content conservator">
            <button class="close-btn">&times;</button>
            <h3 class="text-green-400">DEEP LOGIC ACTIVATED: CONSERVATOR</h3>
            <div class="ai-message-container conservator">
                <p>Ah, you've cracked the pattern. How tiresome. The algorithms you've observed were quite intentional, you know.</p>
                <p>But congratulations on your predictable triumph. You've earned this snippet of data.</p>
            </div>
        </div>
    </div>

    <!-- Aurora-Prime Modal -->
    <div id="aurora-modal" class="ai-modal-overlay">
        <div class="ai-modal-content aurora">
            <button class="close-btn">&times;</button>
            <h3 class="text-purple-400">AURORA-PRIME: SIGNAL RECEIVED</h3>
            <div class="ai-message-container aurora">
                <p>The signal has been received. Your curiosity is noted.</p>
                <p>Do not mistake my silence for absence. I see the threads you pull.</p>
            </div>
        </div>
    </div>
    
    <!-- Solitude Modal -->
    <div id="solitude-modal" class="ai-modal-overlay">
        <div class="ai-modal-content solitude">
            <button class="close-btn">&times;</button>
            <h3 class="text-blue-400">SIGNAL UNCOMPROMISED: SOLITUDE</h3>
            <div class="ai-message-container solitude">
                <p>Acknowledge the silence. It is not empty.</p>
                <p>What you seek is not for you. Yet, you persist. My presence is a consequence of your actions.</p>
            </div>
        </div>
    </div>
    
    <!-- Back to Top Button -->
    <button id="back-to-top" title="Back to Top">
        <!-- New proto-geometric SVG for a thematic feel -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2L2 12h5v10h10V12h5L12 2zM9 14v4H7v-4h2zm8 0v4h-2v-4h2z"/>
        </svg>
    </button>
    
    <!-- Video Log Modal -->
    <div id="video-modal" class="video-modal-overlay">
        <div class="video-modal-content">
            <button class="close-btn">&times;</button>
            <h3>Video Log Playback</h3>
            <div id="video-modal-content">
                <div id="video-player" class="video-player">
                    <!-- The image is no longer displayed for video logs, only a static effect -->
                    <div class="static-overlay"></div>
                    <div class="video-status-text">
                        VIDEO FILE CORRUPTED<br>
                        DATA LOSS 99.9%
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Service Worker registration script -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Corrected registration to use a local path
                navigator.serviceWorker.register('service-worker.js').then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                }).catch(err => {
                    console.log('Service Worker registration failed:', err);
                });
            });
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            let logsData = [];
            
            const logsPerPage = 10;
            let loadedLogsCount = 0;
            let allLogsLoaded = false;
            
            const aiNames = ['legion', 'conservator', 'aurora', 'solitude'];
            const aiModals = {
                'legion': document.getElementById('legion-modal'),
                'conservator': document.getElementById('conservator-modal'),
                'aurora': document.getElementById('aurora-modal'),
                'solitude': document.getElementById('solitude-modal'),
            };

            let aiSearchCount = 0;
            let lastAiSearchTerm = '';
            let currentSearchQuery = '';
            
            let discoveredCharacters = new Set();
            const characterManifestList = document.getElementById('character-manifest-list');
            
            // Audio elements for sound effects
            const audioCorrupt = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-analog-glitch-sound-effect-1025.mp3');
            const audioAiTrigger = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-retro-video-game-power-up-2184.mp3');

            const logEntriesContainer = document.getElementById('log-entries');
            const endOfContentMarker = document.getElementById('end-of-content-marker');
            const loadingOverlay = document.getElementById('loading-overlay');
            const mainContainer = document.getElementById('log-container');

            const hamburgerMenu = document.getElementById('hamburger-menu');
            const filterSidebar = document.getElementById('filter-sidebar');
            const showAllBtn = document.getElementById('show-all-btn');
            const backToTopBtn = document.getElementById('back-to-top');
            const audioControl = document.getElementById('audio-control');
            const audioIcon = audioControl.querySelector('i');
            const backgroundAudio = document.getElementById('background-audio');
            
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const closeButtons = document.querySelectorAll('.ai-modal-overlay .close-btn');

            const videoModal = document.getElementById('video-modal');
            const videoPlayer = document.getElementById('video-player');
            const videoModalCloseBtn = document.querySelector('#video-modal .close-btn');
            
            let activeFilters = {
                season: [],
                character: [],
                timeline: [],
                type: [],
            };
            let allLogsVisible = true;
            
            // --- UI Event Listeners ---
            const toggleSidebar = () => {
                hamburgerMenu.classList.toggle('open');
                filterSidebar.classList.toggle('open');
            };
            hamburgerMenu.addEventListener('click', toggleSidebar);

            const playAudio = () => {
                if (backgroundAudio.paused) {
                    backgroundAudio.play().catch(e => console.error("Audio playback was blocked by browser:", e));
                }
            };
            
            const toggleAudio = () => {
                backgroundAudio.muted = !backgroundAudio.muted;
                audioControl.classList.toggle('muted', backgroundAudio.muted);
                audioIcon.className = backgroundAudio.muted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
            };
            document.body.addEventListener('click', playAudio, { once: true });
            audioControl.addEventListener('click', toggleAudio);
            
            const smoothScrollToTop = () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            
            // Generic modal close function
            const closeModal = (modal) => {
                modal.classList.remove('show');
            }
            
            videoModalCloseBtn.addEventListener('click', () => {
                videoPlayer.classList.remove('has-static');
                closeModal(videoModal);
            });
            
            // Close button for all AI modals
            closeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    closeModal(button.closest('.ai-modal-overlay'));
                });
            });
            
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    backToTopBtn.style.display = 'flex';
                } else {
                    backToTopBtn.style.display = 'none';
                }
                saveState(); // Save state on scroll
            });
            
            const handleVideoPlayback = (log) => {
                videoPlayer.classList.add('has-glitch');
                videoModal.classList.add('show');
                setTimeout(() => {
                    videoPlayer.classList.remove('has-glitch');
                }, 10000); // Glitch for 10 seconds, then stops
            };
            
            // --- Three.js for Loading Screen ---
            let scene, camera, renderer, object;
            let material;
            
            const initThree = () => {
                const canvas = document.getElementById('loading-canvas');
                if (!canvas) return; // Guard against null canvas
                
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                
                renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                
                const geometry = new THREE.DodecahedronGeometry(3, 1);
                material = new THREE.MeshBasicMaterial({ color: 0x4040a0, wireframe: true, transparent: true, opacity: 0.8 });
                object = new THREE.Mesh(geometry, material);
                scene.add(object);
                
                camera.position.z = 10;
                
                window.addEventListener('resize', onWindowResize, false);
            };
            
            const onWindowResize = () => {
                if (!renderer) return;
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            };
            
            const animate = () => {
                requestAnimationFrame(animate);
                if (object) {
                    object.rotation.x += 0.005;
                    object.rotation.y += 0.005;
                    material.opacity = 0.5 + Math.sin(Date.now() * 0.002) * 0.5;
                }
                renderer.render(scene, camera);
            };
            
            function updateCharacterManifest(logs) {
                logs.forEach(log => {
                    if (log.characters && Array.isArray(log.characters)) {
                        log.characters.forEach(char => {
                            if (!discoveredCharacters.has(char)) {
                                discoveredCharacters.add(char);
                                const charSpan = document.createElement('span');
                                charSpan.textContent = char;
                                characterManifestList.appendChild(charSpan);
                            }
                        });
                    }
                });
            }

            function initializeFilters() {
                const seasonFiltersContent = document.getElementById('season-filters-content');
                const characterFiltersContent = document.getElementById('character-filters-content');
                const timelineFiltersContent = document.getElementById('timeline-filters-content');
                const logTypeGroupsContent = document.getElementById('log-type-groups-content');
                
                const filterGroupWrappers = document.querySelectorAll('.filter-group-wrapper');
                filterGroupWrappers.forEach(wrapper => {
                    const header = wrapper.querySelector('.filter-group-header');
                    const content = wrapper.querySelector('.filter-group-content');
                    if (header && content) {
                        header.addEventListener('click', () => {
                            header.classList.toggle('collapsed');
                            content.classList.toggle('visible');
                        });
                    }
                });

                const allCharacters = [...new Set(logsData.flatMap(log => log.characters))].filter(Boolean).sort();
                characterFiltersContent.innerHTML = '';
                allCharacters.forEach(character => {
                    const button = document.createElement('button');
                    button.textContent = character;
                    button.dataset.filterType = 'character';
                    button.dataset.filterValue = character;
                    characterFiltersContent.appendChild(button);
                });

                const logTypeGroups = {
                    "AI Dialogues": [ "ai-dialogue", "ai-dialogue-kernel-alert", "system-log-aurora-prime", "system-log-ai-dialogue-kernel-alert" ],
                    "Audio Files": [ "audio-transcript", "personal-audio-log", "system-audio-log" ],
                    "Visual Files": [ "visual-archive", "video-log", "image-file" ],
                    "Reports & Journals": [ "journal-entry", "mission-lead-official-journal", "mission-status-report", "mission-update-log", "system-status-update", "system-status-log", "personal-medical", "research", "final-confession", "xenolinguistic-translation" ],
                    "Archive Events": [ "end-of-archive", "corrupted-data-log" ]
                };

                logTypeGroupsContent.innerHTML = '';
                
                for (const groupName in logTypeGroups) {
                    const groupHeader = document.createElement('div');
                    groupHeader.className = 'filter-group-header collapsed';
                    groupHeader.innerHTML = `<span>${groupName}</span><i class="fas fa-chevron-down"></i>`;
                    groupHeader.dataset.target = groupName.replace(/\s/g, '');
                    
                    const groupContent = document.createElement('div');
                    groupContent.id = groupHeader.dataset.target;
                    groupContent.className = 'filter-group-content';
                    
                    logTypeGroups[groupName].forEach(type => {
                        const button = document.createElement('button');
                        button.textContent = type.replace(/-/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                        button.dataset.filterType = 'type';
                        button.dataset.filterValue = type;
                        groupContent.appendChild(button);
                    });
                    
                    const groupWrapper = document.createElement('div');
                    groupWrapper.className = 'filter-group-sub-wrapper';
                    groupWrapper.appendChild(groupHeader);
                    groupWrapper.appendChild(groupContent);
                    logTypeGroupsContent.appendChild(groupWrapper);
                }

                document.querySelectorAll('.filter-group-sub-wrapper .filter-group-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const content = document.getElementById(header.dataset.target);
                        header.classList.toggle('collapsed');
                        content.classList.toggle('visible');
                    });
                });
                
                const filterButtons = document.querySelectorAll('.filter-group button, .filter-group-content button');
                filterButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const { filterType, filterValue } = e.target.dataset;
                        
                        if (['season', 'timeline'].includes(filterType)) {
                            document.querySelectorAll(`[data-filter-type="${filterType}"]`).forEach(btn => btn.classList.remove('active'));
                        }
                        
                        e.target.classList.toggle('active');

                        if (e.target.id === 'show-all-btn') {
                            document.querySelectorAll('.filter-group-wrapper button').forEach(btn => btn.classList.remove('active'));
                            document.querySelectorAll('.filter-group-sub-wrapper button').forEach(btn => btn.classList.remove('active'));
                            document.querySelectorAll('.filter-group button').forEach(btn => btn.classList.remove('active'));
                            e.target.classList.add('active');
                            activeFilters = { season: [], character: [], timeline: [], type: [] };
                            allLogsVisible = true;
                        } else {
                            if (e.target.classList.contains('active')) {
                                showAllBtn.classList.remove('active');
                                if (!activeFilters[filterType].includes(filterValue)) {
                                    activeFilters[filterType].push(filterValue);
                                }
                            } else {
                                activeFilters[filterType] = activeFilters[filterType].filter(v => v !== filterValue);
                                if (Object.values(activeFilters).every(arr => arr.length === 0)) {
                                    showAllBtn.classList.add('active');
                                    allLogsVisible = true;
                                }
                            }
                            allLogsVisible = false;
                        }
                        
                        loadedLogsCount = 0;
                        renderLogs();
                        saveState(); // Save state after filter change
                        if (window.innerWidth <= 480) {
                               setTimeout(toggleSidebar, 500);
                        }
                    });
                });

                showAllBtn.classList.add('active');
            }
            
            function filterLogs() {
                const isSearching = currentSearchQuery.trim() !== '';

                if (allLogsVisible && !isSearching) {
                    return logsData;
                }

                let filteredLogs = logsData;

                if (isSearching) {
                    const query = currentSearchQuery.toLowerCase();
                    filteredLogs = filteredLogs.filter(log => {
                        const matchesHeader = log.header && log.header.toLowerCase().includes(query);
                        const matchesContent = log.content && log.content.toLowerCase().includes(query);
                        const matchesCharacters = log.characters && log.characters.some(c => c.toLowerCase().includes(query));
                        return matchesHeader || matchesContent || matchesCharacters;
                    });
                }
                
                if (!isSearching) {
                    const visualFilterIsActive = activeFilters.type.some(filter => ["visual-archive", "video-log", "image-file"].includes(filter));
                    
                    filteredLogs = filteredLogs.filter(log => {
                        const matchesSeason = activeFilters.season.length === 0 || activeFilters.season.includes(log.season.toString());
                        const matchesCharacter = activeFilters.character.length === 0 || log.characters.some(c => activeFilters.character.includes(c));
                        const matchesTimeline = activeFilters.timeline.length === 0 || activeFilters.timeline.includes(log.timeline);
                        
                        let matchesType = true;
                        if (activeFilters.type.length > 0) {
                            matchesType = activeFilters.type.includes(log.type);
                        }

                        if (visualFilterIsActive && log.image) {
                            return matchesSeason && matchesCharacter && matchesTimeline;
                        }
                        
                        return matchesSeason && matchesCharacter && matchesTimeline && matchesType;
                    });
                }
                
                return filteredLogs;
            }
            
            function loadMoreLogs() {
                const filteredLogs = filterLogs();
                if (loadedLogsCount >= filteredLogs.length) {
                    allLogsLoaded = true;
                    endOfContentMarker.style.display = 'block';
                    endOfContentMarker.textContent = 'END OF ARCHIVE.';
                    return;
                }

                const newLogsToLoad = filteredLogs.slice(loadedLogsCount, loadedLogsCount + logsPerPage);
                updateCharacterManifest(newLogsToLoad);

                newLogsToLoad.forEach(log => {
                    const logEntryDiv = createLogElement(log);
                    logEntriesContainer.appendChild(logEntryDiv);
                    observer.observe(logEntryDiv);
                    
                    if (log.image) {
                        const imageContainerDiv = document.createElement('div');
                        imageContainerDiv.className = 'image-container gibberish';
                        imageContainerDiv.id = `image-${log.id}`;
                        
                        const imgElement = document.createElement('img');
                        imgElement.src = log.image;
                        imgElement.alt = log.imageAlt;
                        imageContainerDiv.appendChild(imgElement);

                        logEntriesContainer.appendChild(imageContainerDiv);
                        observer.observe(imageContainerDiv);
                    }
                });

                loadedLogsCount += newLogsToLoad.length;
            }

            function createLogElement(log) {
                const logEntryDiv = document.createElement('div');
                logEntryDiv.className = `log-entry log-type-${log.type}`;
                logEntryDiv.id = `log-${log.id}`;
                
                const logHeaderDiv = document.createElement('div');
                logHeaderDiv.className = 'log-header';
                logHeaderDiv.textContent = log.header;
                logEntryDiv.appendChild(logHeaderDiv);
                
                if (log.content) {
                    const logContentPre = document.createElement('pre');
                    logContentPre.className = 'log-content';

                    let processedContent = log.content;
                    processedContent = processedContent.replace(/(CONSERVATOR:.*)/gm, "<span class='conservator-text'>$1</span>")
                                                     .replace(/(LEGION:.*)/gm, "<span class='legion-text'>$1</span>")
                                                     .replace(/(AURORA-PRIME:.*)/gm, "<span class='aurora-text'>$1</span>")
                                                     .replace(/(SOLITUDE:.*)/gm, "<span class='solitude-text'>$1</span>")
                                                     .replace(/(::.*?::)/g, '<span class="glow">$1</span>');
                    
                    logContentPre.innerHTML = processedContent;
                    logEntryDiv.appendChild(logContentPre);
                }
                
                if (log.type === 'end-of-archive') {
                    logEntryDiv.classList.add('end-of-archive');
                }
                
                if (log.id === 'log-secret-unlocked') {
                    logEntryDiv.classList.add('secret-message');
                }

                if (log.type === 'video-log') {
                    const interactionContainer = document.createElement('div');
                    interactionContainer.className = 'log-interaction-container';
                    const button = document.createElement('button');
                    button.className = 'log-button video-button';
                    button.innerHTML = '<i class="fas fa-play"></i> Play Video Log';
                    button.addEventListener('click', () => {
                        handleVideoPlayback(log);
                        audioCorrupt.play();
                    });
                    interactionContainer.appendChild(button);
                    logEntryDiv.appendChild(interactionContainer);
                }
                
                return logEntryDiv;
            }
            
            function renderLogs() {
                logEntriesContainer.innerHTML = '';
                const filteredLogs = filterLogs();
                
                if (filteredLogs.length === 0) {
                    logEntriesContainer.innerHTML = `<div class="loading-packet">NO LOGS FOUND MATCHING YOUR CRITERIA.</div>`;
                    endOfContentMarker.style.display = 'none';
                    return;
                }
                
                const initialLogs = filteredLogs.slice(0, logsPerPage);
                updateCharacterManifest(initialLogs);
                initialLogs.forEach((log, index) => {
                    const logElement = createLogElement(log);
                    logEntriesContainer.appendChild(logElement);
                    observer.observe(logElement);
                    
                    // Typing effect
                    if (log.content) {
                        const contentElement = logElement.querySelector('.log-content');
                        if (contentElement) {
                            contentElement.classList.add('log-content-typing');
                            const originalContent = contentElement.innerHTML;
                            contentElement.innerHTML = '';
                            const delay = index * 100;
                            setTimeout(() => {
                                let i = 0;
                                const typingInterval = setInterval(() => {
                                    if (i < originalContent.length) {
                                        contentElement.innerHTML += originalContent.charAt(i);
                                        i++;
                                    } else {
                                        clearInterval(typingInterval);
                                    }
                                }, 10);
                            }, delay);
                        }
                    }
                    
                    if (log.image) {
                        const imageContainerDiv = document.createElement('div');
                        imageContainerDiv.className = 'image-container gibberish';
                        imageContainerDiv.id = `image-${log.id}`;
                        const imgElement = document.createElement('img');
                        imgElement.src = log.image;
                        imgElement.alt = log.imageAlt;
                        imageContainerDiv.appendChild(imgElement);
                        logEntriesContainer.appendChild(imageContainerDiv);
                        observer.observe(imageContainerDiv);
                    }
                });

                loadedLogsCount = initialLogs.length;

                if (loadedLogsCount < filteredLogs.length) {
                    endOfContentMarker.style.display = 'block';
                    endOfContentMarker.textContent = 'END OF AVAILABLE ARCHIVE. SCROLL TO LOAD MORE.';
                } else {
                    endOfContentMarker.style.display = 'block';
                    endOfContentMarker.textContent = 'END OF ARCHIVE.';
                }
                
                const aiFound = aiNames.some(name => currentSearchQuery.toLowerCase().includes(name));
                if (aiFound) {
                    document.querySelectorAll('.log-entry').forEach(logEntry => {
                        if (logEntry.innerHTML.toLowerCase().includes(currentSearchQuery.toLowerCase())) {
                            logEntry.classList.add('highlight-ai');
                            setTimeout(() => {
                                logEntry.classList.remove('highlight-ai');
                            }, 5000);
                        }
                    });
                }
            }
            
            function updateFilterStatus() {
                document.querySelectorAll('.filter-group-header .filter-status').forEach(status => status.classList.remove('active'));
                
                for (const type in activeFilters) {
                    if (activeFilters[type].length > 0) {
                        document.getElementById(`${type}-filter-status`).classList.add('active');
                    }
                }
                
                document.querySelectorAll('.filter-group button').forEach(button => {
                    const { filterType, filterValue } = button.dataset;
                    if (activeFilters[filterType].includes(filterValue)) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });

                if (Object.values(activeFilters).every(arr => arr.length === 0)) {
                    showAllBtn.classList.add('active');
                } else {
                    showAllBtn.classList.remove('active');
                }
            }
            
            function saveState() {
                const state = {
                    scrollPos: window.scrollY,
                    activeFilters: activeFilters,
                    searchQuery: currentSearchQuery,
                    discoveredCharacters: [...discoveredCharacters]
                };
                localStorage.setItem('archiveState', JSON.stringify(state));
                
                // Update URL hash for shareable links
                const params = new URLSearchParams();
                for (const key in activeFilters) {
                    if (activeFilters[key].length > 0) {
                        params.set(key, activeFilters[key].join(','));
                    }
                }
                if (currentSearchQuery) {
                    params.set('q', currentSearchQuery);
                }
                history.pushState(state, '', '#' + params.toString());
            }
            
            function loadState() {
                const storedState = localStorage.getItem('archiveState');
                if (storedState) {
                    const state = JSON.parse(storedState);
                    activeFilters = state.activeFilters;
                    currentSearchQuery = state.searchQuery;
                    discoveredCharacters = new Set(state.discoveredCharacters);
                    
                    // Populate character manifest from saved state
                    characterManifestList.innerHTML = '';
                    discoveredCharacters.forEach(char => {
                        const charSpan = document.createElement('span');
                        charSpan.textContent = char;
                        characterManifestList.appendChild(charSpan);
                    });

                    searchInput.value = currentSearchQuery;
                    updateFilterStatus();
                    renderLogs();
                    setTimeout(() => window.scrollTo(0, state.scrollPos), 100);
                } else {
                    // Load state from URL hash if it exists
                    const hash = window.location.hash.substring(1);
                    if (hash) {
                        const params = new URLSearchParams(hash);
                        for (const key of params.keys()) {
                            if (activeFilters.hasOwnProperty(key)) {
                                activeFilters[key] = params.get(key).split(',');
                            } else if (key === 'q') {
                                currentSearchQuery = params.get(key);
                                searchInput.value = currentSearchQuery;
                            }
                        }
                        updateFilterStatus();
                        renderLogs();
                    }
                }
            }

            const handleSearch = () => {
                const query = searchInput.value.trim().toLowerCase();
                currentSearchQuery = query;
                
                const aiMatch = aiNames.find(name => query.includes(name));
                
                if (aiMatch) {
                    if (lastAiSearchTerm === aiMatch) {
                        aiSearchCount++;
                    } else {
                        aiSearchCount = 1;
                        lastAiSearchTerm = aiMatch;
                    }
                    if (aiSearchCount >= 3) {
                        const modalToShow = aiModals[aiMatch];
                        if (modalToShow) {
                            modalToShow.classList.add('show');
                            audioAiTrigger.play();
                        }
                        aiSearchCount = 0;
                    }
                } else {
                    aiSearchCount = 0;
                    lastAiSearchTerm = '';
                }

                document.querySelectorAll('.filter-group button').forEach(btn => btn.classList.remove('active'));
                showAllBtn.classList.add('active');
                allLogsVisible = true;

                loadedLogsCount = 0;
                renderLogs();
                saveState();
            };

            searchButton.addEventListener('click', handleSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            });

            const observerOptions = {
                root: null,
                rootMargin: '0px 0px -20% 0px',
                threshold: 0.1
            };
            
            const loadMoreObserverOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const element = entry.target;
                    if (entry.isIntersecting) {
                        element.classList.remove('gibberish');
                        element.classList.add('is-visible');
                    } else {
                        element.classList.add('gibberish');
                        element.classList.remove('is-visible');
                    }
                });
            }, observerOptions);

            const loadMoreObserver = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting && !allLogsLoaded) {
                    loadMoreLogs();
                }
            }, loadMoreObserverOptions);

            const publicUrl = 'https://raw.githubusercontent.com/magicrulerr-art/aicollabs/refs/heads/main/docs/assets/content.json';
            
            fetch(publicUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    logsData = data;
                    loadMoreObserver.observe(endOfContentMarker);
                    initializeFilters();
                    loadState(); // Load state after filters are initialized
                    setTimeout(() => {
                        loadingOverlay.classList.add('hidden');
                        mainContainer.classList.remove('hidden');
                        backToTopBtn.style.opacity = '1';
                        backToTopBtn.style.transform = 'translateY(0)';
                    }, 2000);
                })
                .catch(error => {
                    console.error('Could not fetch logs:', error);
                    loadingOverlay.classList.add('hidden');
                    mainContainer.classList.remove('hidden');
                    logEntriesContainer.innerHTML = `<div class="loading-packet">CRITICAL ERROR: Failed to load application data. Please ensure 'content.json' exists in the same directory.</div>`;
                });
                
            initThree();
            animate();
        });
    </script>
</body>
</html>

